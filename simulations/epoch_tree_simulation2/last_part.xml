
	<!-- The unique patterns from 1 to end                                       -->
	<!-- npatterns=995                                                           -->
	<patterns id="patterns" from="1">
		<alignment idref="alignment"/>
	</patterns>

	<!-- A prior assumption that the population size has remained constant       -->
	<!-- throughout the time spanned by the genealogy.                           -->
	<constantSize id="constant" units="months">
		<populationSize>
			<parameter id="constant.popSize" value="80.0" lower="0.0"/>
		</populationSize>
	</constantSize>

	<!-- Generate a random starting tree under the coalescent process            -->
	<coalescentTree id="startingTree">
		<taxa idref="taxa"/>
		<constantSize idref="constant"/>
	</coalescentTree>

<!--	 Generate a tree model                                                   -->
	<treeModel id="treeModel">
		<newick idref="startingTree"/>
		<rootHeight>
			<parameter id="treeModel.rootHeight"/>
		</rootHeight>
		<nodeHeights internalNodes="true">
			<parameter id="treeModel.internalNodeHeights"/>
		</nodeHeights>
		<nodeHeights internalNodes="true" rootNode="true">
			<parameter id="treeModel.allInternalNodeHeights"/>
		</nodeHeights>
	</treeModel>

	<!-- Generate a coalescent likelihood                                        -->
	<coalescentLikelihood id="coalescent">
		<model>
			<constantSize idref="constant"/>
		</model>
		<populationTree>
			<treeModel idref="treeModel"/>
		</populationTree>
	</coalescentLikelihood>

	<!-- The strict clock (Uniform rates across branches)                        -->
	<strictClockBranchRates id="branchRates">
		<rate>
			<parameter id="clock.rate" value="1.2E-2" lower="0.0" upper="100.0"/>
		</rate>
	</strictClockBranchRates>

    <!-- Epoch Model -->
	  <frequencyModel id="freqModel" dataType="nucleotide">
                 <frequencies>
                      <parameter id="frequencies" dimension="4" value="0.25 0.25 0.25 0.25"/>
                 </frequencies>
     </frequencyModel>

    <hkyModel id="hky.1">
         <frequencies>
             <frequencyModel idref="freqModel"/>
         </frequencies>
         <kappa>
             <parameter id="kappa.1" value="1.0" lower="0.0" upper="100.0"/>
         </kappa>
     </hkyModel>

     <hkyModel id="hky.2">
         <frequencies>
             <frequencyModel idref="freqModel"/>
         </frequencies>
         <kappa>
             <parameter id="kappa.2" value="1.0" lower="0.0" upper="100.0"/>
         </kappa>
     </hkyModel>
     
     <hkyModel id="hky.3">
         <frequencies>
             <frequencyModel idref="freqModel"/>
         </frequencies>
         <kappa>
             <parameter id="kappa.3" value="1.0" lower="0.0" upper="100.0"/>
         </kappa>
     </hkyModel>
     
<!-- epoch model -->
     <epochBranchModel id="epochModel">

         <epoch id="epoch1" transitionTime="7">
         	<hkyModel idref="hky.1"/> 
         </epoch>

         <epoch id="epoch2" transitionTime="15">
         	<hkyModel idref="hky.2"/> 
         </epoch>

         <hkyModel idref="hky.3"/>

         <treeModel idref="treeModel"/>
     </epochBranchModel>

	<!-- site model                                                              -->
	<siteModel id="siteModel">
		<branchSubstitutionModel> 
             		<beagleSubstitutionEpochModel idref="epochModel"/>
		</branchSubstitutionModel> 
<!--	     <gammaShape gammaCategories="4">-->
<!--			<parameter id="siteModel.alpha" value="0.5" lower="0.0" upper="1000.0"/>-->
<!--		</gammaShape>-->
	</siteModel>

	<!-- Likelihood for tree given sequence data                                 -->
	<treeLikelihood id="treeLikelihood">
        <patterns idref="patterns"/>
		<treeModel idref="treeModel"/>
		<siteModel idref="siteModel"/>
		<beagleSubstitutionEpochModel idref="epochModel"/>	
        <strictClockBranchRates idref="branchRates"/>
	</treeLikelihood>

	<!-- Define operators                                                        -->
	<operators id="operators">
	
		<scaleOperator scaleFactor="0.75" weight="0.1">
			<parameter idref="kappa.1"/>
		</scaleOperator>
		
		<scaleOperator scaleFactor="0.75" weight="0.1">
			<parameter idref="kappa.2"/>
		</scaleOperator>

		<scaleOperator scaleFactor="0.75" weight="0.1">
			<parameter idref="kappa.3"/>
		</scaleOperator>
		
		<subtreeSlide size="0.13999999999999999" gaussian="true" weight="15">
			<treeModel idref="treeModel"/>
		</subtreeSlide>
		
		<narrowExchange weight="15">
			<treeModel idref="treeModel"/>
		</narrowExchange>
		
		<wideExchange weight="3">
			<treeModel idref="treeModel"/>
		</wideExchange>
		
		<wilsonBalding weight="3">
			<treeModel idref="treeModel"/>
		</wilsonBalding>
		
		<scaleOperator scaleFactor="0.75" weight="3">
			<parameter idref="treeModel.rootHeight"/>
		</scaleOperator>
		
		<uniformOperator weight="30">
			<parameter idref="treeModel.internalNodeHeights"/>
		</uniformOperator>
		
		<scaleOperator scaleFactor="0.75" weight="3">
			<parameter idref="constant.popSize"/>
		</scaleOperator>

		<scaleOperator scaleFactor="0.75" weight="5">
			<parameter idref="clock.rate"/>
		</scaleOperator>
		
		<upDownOperator scaleFactor="0.75" weight="5">
			<up>
				<parameter idref="clock.rate"/>
			</up>
			<down>
				<parameter idref="treeModel.allInternalNodeHeights"/>
			</down>
		</upDownOperator>
		
	</operators>

	<!-- Define MCMC                                                             -->
	<mcmc id="mcmc" chainLength="10000000" autoOptimize="true">
		<posterior id="posterior">
			<prior id="prior">
			
				<logNormalPrior mean="1.0" stdev="2" offset="0.0" meanInRealSpace="true">
					<parameter idref="kappa.1"/>
				</logNormalPrior>
				
				<logNormalPrior mean="1.0" stdev="2" offset="0.0" meanInRealSpace="true">
					<parameter idref="kappa.2"/>
				</logNormalPrior>

				<logNormalPrior mean="1.0" stdev="2" offset="0.0" meanInRealSpace="true">
					<parameter idref="kappa.3"/>
				</logNormalPrior>
				
				<uniformPrior lower="0.0" upper="1.0">
					<parameter idref="clock.rate"/>
				</uniformPrior>

				<logNormalPrior mean="1.0" stdev="2" offset="0.0" meanInRealSpace="true">
					<parameter idref="constant.popSize"/>
				</logNormalPrior>
				
				<coalescentLikelihood idref="coalescent"/>
				
			</prior>
			
			<likelihood id="likelihood">
				<treeLikelihood idref="treeLikelihood"/>
			</likelihood>
			
		</posterior>
		<operators idref="operators"/>

		<!-- write log to screen                                                     -->
		<log id="screenLog" logEvery="5000">
		
			<column label="kappa.1" sf="6" width="12">
				<parameter idref="kappa.1"/>
			</column>
			
			<column label="kappa.2" sf="6" width="12">
				<parameter idref="kappa.2"/>
			</column>

			<column label="kappa.3" sf="6" width="12">
				<parameter idref="kappa.3"/>
			</column>
			
			<column label="rootHeight" sf="6" width="12">
				<parameter idref="treeModel.rootHeight"/>
			</column>
			
			<column label="clock.rate" sf="6" width="12">
				<parameter idref="clock.rate"/>
			</column>
			
		</log>

		<!-- write tree log to file                                                  -->
		<logTree id="treeFileLog" logEvery="1000" nexusFormat="true" fileName="epoch.trees" sortTranslationTable="true">
			<treeModel idref="treeModel"/>
			<strictClockBranchRates idref="branchRates"/>
			<posterior idref="posterior"/>
		</logTree>

	</mcmc>
	
</beast>
